<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bắn Thuyền - Nhóm 1 & Nhóm 2 (Quiz flow - Ocean Theme)</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&display=swap');

body {
    font-family: 'Be Vietnam Pro', sans-serif;
    height: 100vh;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    position: relative;
    overflow: hidden;
    background: url('Light Blue Pirate Birthday Poster.png') no-repeat center center fixed;
    background-size: cover; 
    padding-top: 100px; /* Added padding to avoid overlapping with controls */
}

.container {
    display: flex;
    align-items: flex-start;
    justify-content: center;
    gap: 100px;
    position: relative;
    z-index: 5;
}

.divider {
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(to bottom, transparent, #9ac7e5, transparent);
    transform: translateX(-50%);
}

.board-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}

h2 {
    margin-bottom: 20px;
    font-weight: 700;
    letter-spacing: 0.5px;
    font-size: 28px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.board {
    display: grid;
    grid-template-columns: 45px repeat(5, 70px);
    grid-template-rows: 45px repeat(5, 70px);
    gap: 6px;
    background: #cde8f8;
    padding: 20px;
    border-radius: 25px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
}

.label {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 700;
    color: #444;
}

.cell {
    background: white;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.16s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    font-weight: 800;
    position: relative;
}

.cell:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
}

/* Trạng thái ô đã trả lời quiz */
.cell[data-answered="true"] {
    cursor: pointer;
    background: white !important;
}
.cell[data-answered="true"]:hover {
    transform: scale(1.05);
}

/* Dấu tròn trúng/trượt */
.cell.hit::before, .cell.miss::before {
    content: '';
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    z-index: 2;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.4);
}
.cell.hit::before { background: #b30000; }
.cell.miss::before { background: #0056cc; }
.cell.hit, .cell.miss {
    background: white !important;
    color: transparent;
}

/* Popup chọn màu */
.popup {
    position: absolute;
    background: white;
    border-radius: 15px;
    padding: 15px;
    display: flex;
    gap: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 10;
}
.color-btn {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.color-btn.red { background: #b30000; }
.color-btn.blue { background: #0056cc; }

/* Quiz overlay */
.quiz-popup {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.6);
    z-index: 50;
}
.quiz-box {
    width: 750px; 
    background: #fff9f3;
    border-radius: 25px;
    padding: 40px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.5);
    text-align: center;
    transition: transform 0.1s ease-in-out;
}
@keyframes shake-and-celebrate {
    0% { transform: scale(1) rotate(0deg); }
    20% { transform: scale(1.04) rotate(-1.5deg); }
    40% { transform: scale(1.04) rotate(1.5deg); }
    60% { transform: scale(1.04) rotate(-1.5deg); }
    80% { transform: scale(1.04) rotate(1.5deg); }
    100% { transform: scale(1) rotate(0deg); }
}
.quiz-box.celebrate {
    animation: shake-and-celebrate 0.5s;
}
.quiz-question {
    font-weight: 700;
    margin-bottom: 30px;
    font-size: 22px;
    text-align: justify;
    line-height: 1.5;
}
.option {
    background: #f0e2d2;
    padding: 18px;
    border-radius: 15px;
    margin: 12px 0;
    cursor: pointer;
    transition: 0.14s;
    text-align: left;
    font-size: 18px;
    font-weight: 500;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}
.option:hover { 
    transform: translateY(-3px);
    background: #e0d2c2;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}
.option.correct {
    background: #d4f5d6;
    border: 3px solid #8cd179;
    font-weight: 700;
}
.option.wrong {
    background: #ffd7d7;
    border: 3px solid #ff7b7b;
    font-weight: 700;
}
.fitb-input {
    width: 90%;
    padding: 15px;
    margin: 20px 0;
    border: 3px solid #ccc;
    border-radius: 12px;
    font-size: 20px;
    text-align: center;
    font-weight: 600;
}
.fitb-feedback {
    margin-top: 25px;
    font-weight: 800;
    font-size: 26px;
    display: block;
}
.fitb-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    background: #0056cc;
    color: white;
    cursor: pointer;
    margin-top: 20px;
    transition: 0.14s;
    font-weight: 700;
    font-size: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}
.fitb-btn:hover { background: #0044a0; }

.back-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    background: #6c757d;
    color: white;
    cursor: pointer;
    margin-top: 30px;
    font-size: 20px;
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: background 0.14s;
}
.back-btn:hover { background: #5a6268; }

/* --- RULE BUTTON & POPUP STYLES --- */
.action-btn {
    padding: 12px 25px;
    font-size: 18px;
    font-weight: 700;
    color: white;
    background: #6c757d; 
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
}
.action-btn:hover {
    background: #5a6268;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
}
.action-btn:active {
    transform: translateY(0);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

/* Container bọc các nút ở góc phải trên cùng */
#controls-container {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    flex-direction: column; /* Xếp dọc */
    gap: 10px; /* Khoảng cách giữa các nút */
    z-index: 60;
}

.rule-popup {
    position: fixed;
    inset: 0;
    display: none; 
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.7);
    z-index: 100;
}

.rule-box {
    width: 800px; 
    max-height: 65vh; 
    overflow-y: hidden; 
    background: #fff9f3; 
    border-radius: 25px; 
    padding: 40px; 
    box-shadow: 0 15px 40px rgba(0,0,0,0.5);
    color: #212529; 
    text-align: center;
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}
.rule-box::-webkit-scrollbar {
    display: none;
}

.rule-content {
    font-size: 17px; 
    font-weight: 500; 
    line-height: 1.7;
    text-align: justify;
    margin-bottom: 25px;
    padding: 0 10px; 
}

.rule-box h3 {
    color: #b30000; 
    font-size: 24px;
    margin-top: 0;
    border-bottom: 2px solid #ced4da; 
    padding-bottom: 10px;
    font-weight: 800; 
}

.rule-box .section-title {
    color: #b30000;
    font-weight: 800;
    font-size: 20px;
    display: block; 
    margin-top: 15px;
    margin-bottom: 5px;
    text-align: left;
}

.rule-box ol, .rule-box ul {
    text-align: justify;
    padding-left: 30px;
    font-size: 17px;
    font-weight: 500;
}

.dot {
    display: inline-block;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    margin-right: 8px;
    vertical-align: middle;
}
.dot.red { background-color: #b30000; }
.dot.blue { background-color: #0056cc; }

/* --- New Ship Placement Styles --- */
.ship-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: absolute;
    top: 100px;
    left: 20px;
    z-index: 10;
}

.ship {
    background: #808080;
    border-radius: 5px;
    cursor: grab;
    display: flex;
}

.ship.horizontal {
    flex-direction: row;
}

.ship.vertical {
    flex-direction: column;
}

.ship-unit {
    width: 70px;
    height: 70px;
    background: #808080;
    border: 1px solid #000;
    box-sizing: border-box;
}

.cell.ship {
    background: #808080 !important;
}

#show-ships-popup {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.6);
    z-index: 50;
}

.show-ships-box {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}

.show-ships-box button {
    margin: 10px;
    padding: 10px 20px;
    background: #0056cc;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.show-ships-box button:hover {
    background: #0044a0;
}
</style>
</head>
<body>
    <!-- Container bọc các nút ở góc phải trên cùng -->
    <div id="controls-container">
        <button id="placeShipsBtn" class="action-btn">Đặt Thuyền</button>
        <button id="showShipsBtn" class="action-btn">Hiện Thuyền</button>
        <button id="ruleBtn" class="action-btn">Luật Chơi</button>
    </div>

    <div class="container">
        <div class="divider"></div>
        <div class="board-container">
            <h2 style="color:#b30000">BẢNG NHÓM 1</h2>
            <div class="board" id="board1"></div>
        </div>
        <div class="board-container">
            <h2 style="color:#0056cc">BẢNG NHÓM 2</h2>
            <div class="board" id="board2"></div>
        </div>
    </div>

    <div id="popup" class="popup" style="display:none;">
        <button class="color-btn red" title="Đánh dấu Trúng"></button>
        <button class="color-btn blue" title="Đánh dấu Trượt"></button>
    </div>

    <div id="rulePopup" class="rule-popup">
        <div class="rule-box" role="dialog" aria-modal="true">
            <h3>⚓ LUẬT CHƠI BẮN THUYỀN ⚓</h3>
            <div class="rule-content">
                <span class="section-title">LUẬT CHƠI:</span>
                <ol>
                    <li>Mỗi đội có 3 thuyền: 1 thuyền dài 3 ô, 1 thuyền dài 2 ô và 1 thuyền dài 1 ô.</li>
                    <li>Hai đội đặt thuyền bí mật trên bảng ô vuông.</li>
                    <li>Lượt chơi: mỗi đội bắn vào tọa độ trên bảng đối phương.</li>
                    <ul>          
                        <li>Trúng thuyền: đánh dấu <span class="dot red"></span>.</li>
                        <li>Không trúng: đánh dấu <span class="dot blue"></span>.</li>
                    </ul>
                    <li>Đội nào bắn chìm hết thuyền của đối phương trước là <strong style="color: #0056cc;">đội thắng</strong>.</li>
                </ol>
                <span class="section-title">CÁCH TÍNH ĐIỂM:</span>
                <ul>
                    <li>Mỗi người trả lời đúng câu hỏi được <strong style="color: #0056cc;">+1 điểm</strong>.</li>
                    <li>Đội nào bắn chìm toàn bộ thuyền đối phương trước sẽ được <strong style="color: #0056cc;">+2 điểm</strong> cho <strong>cả đội</strong>.</li>
                </ul>
            </div>
            <button id="closeRuleBtn" class="back-btn" style="background: #6c757d;">Đóng</button>
        </div>
    </div>

    <div id="quizPopup" class="quiz-popup">
        <div id="quizBox" class="quiz-box" role="dialog" aria-modal="true">
            <div id="quizQuestion" class="quiz-question"></div>
            <div id="quizContent"></div>
            <button id="backBtn" class="back-btn">Quay lại bảng</button>
        </div>
    </div>

    <div id="show-ships-popup" class="quiz-popup">
        <div class="show-ships-box">
            <h3>Chọn hiển thị thuyền</h3>
            <button id="show-team1">Hiện thuyền Team 1</button>
            <button id="show-team2">Hiện thuyền Team 2</button>
            <button id="show-both">Hiện cả hai</button>
            <button id="hide-all-ships">Ẩn tất cả</button>
        </div>
    </div>

<script>
/* --- DATA CÂU HỎI TỔNG HỢP --- */
const officialQuestions = [
    { type: 'mc', q: "Đại hội VII rút ra được bao nhiêu bài học từ đại hội trước đó?", options: ["3","4","5","6"], ans: 2 },
    { type: 'mc', q: "Nhiệm vụ nào sau đây được nêu ra trong Đại hội VII?", options: ["Bước đầu ổn định và từng bước cải thiện đời sống vật chất và văn hoá của nhân dân lao động.","Cần kiệm để công nghiệp hoá, khắc phục xu hướng chạy theo “xã hội tiêu dùng\".","Nâng cao năng lực lãnh đạo, năng lực cầm quyền và sức chiến đấu của Đảng, xây dựng Đảng và hệ thống chính trị trong sạch, vững mạnh.", "Phát huy quyền tự chủ trong sản xuất kinh doanh của các xí nghiệp quốc doanh."], ans: 0 },
    { type: 'mc', q: "Lần đầu tiên Đảng giương cao ngọn cờ tư tưởng Hồ Chí Minh vào đại hội nào?", options: ["Đại hội VI (1986)","Đại hội VII (1991)","Đại hội VIII (1996)","Đại hội IX (2001)"], ans: 1 },
    { type: 'mc', q: "Trong Hội nghị 4 đã ban hành 5 nghị quyết dựa trên quan điểm coi gì là mục tiêu phấn đấu cao nhất của Đảng?", options: ["Độc lập của dân tộc","Quyền tự do của con người","Đất nước ổn định và phát triển","Hạnh phúc của con người"], ans: 3 },
    { type: 'mc', q: "Đại hội Đại biểu Toàn quốc năm 1991 nhấn mạnh mục tiêu tổng quát là gì?", options: ["Vượt khó khăn thử thách, ổn định và phát triển kinh tế - xã hội, tăng cường ổn định chính trị, đẩy lùi tiêu cực và bất công xã hội, đưa nước ta cơ bản ra khỏi tình trạng khủng hoảng.","Vượt khó khăn thử thách, xây dựng đất nước cộng sản, tăng cường ổn định chính trị, đẩy lùi tiêu cực và bất công xã hội.","Vượt khó khăn thử thách, xây dựng đất nước cộng sản, ổn định và phát triển kinh tế - xã hội, tăng cường ổn định chính trị, đẩy lùi tiêu cực và bất công xã hội, đưa nước ta cơ bản ra khỏi tình trạng khủng hoảng.","Vượt khó khăn thử thách, ổn định và phát triển kinh tế - xã hội, tăng cường ổn định chính trị, đưa đất nước tiến đến phát triển nông nghiệp."], ans: 0 },
    { type: 'mc', q: "Đại hội VII của Đảng là:", options: ["“Đại hội của sáng tạo - đổi mới - dân chủ - kỷ cương - đoàn kết\"","“Đại hội của trí tuệ - đổi mới - dân chủ - kỷ cương - đoàn kết\"","“Đại hội của sáng tạo - phát triển - dân chủ - kỷ cương - đoàn kết”","“Đại hội của trí tuệ - phát triển - dân chủ - kỷ cương - đoàn kết\""], ans: 1 },
    { type: 'fitb', q: "Đảng lấy chủ nghĩa Mác - Lênin và tư tưởng Hồ Chí Minh làm \_\_\_\_\_ cho hành động.", correctAnswer: "nền tảng tư tưởng, kim chỉ nam" },
    { type: 'mc', q: "Việt Nam và Trung Quốc thiết lập lại và bình thường hóa mối quan hệ giữa 2 nước vào thời gian nào?", options: ["2/1991","7/1991","10/1991","11/1991"], ans: 3 },
    { type: 'mc', q: "Việt Nam và Hoa Kỳ thiết lập lại quan hệ ngoại giao vào năm nào?", options: ["1993","1995","1997","2001"], ans: 1 },
    { type: 'mc', q: "BCH Trung ương Đại hội VII ra chỉ đạo đổi mới toàn diện, trong đó coi đâu là Mặt trận hàng đầu?", options: ["Công nghiệp","Nông nghiệp","Thương nghiệp","Cả a, b, c"], ans: 1 },
    { type: 'fitb', q: "“Đại hội VII là Đại hội của \_\_\_\_\_ dân chủ - kỷ cương - đoàn kết\"", correctAnswer: "trí tuệ - đổi mới" },
    { type: 'mc', q: "Đại hội Đảng toàn quốc lần thứ VII đã thông qua những văn kiện nào?", options: ["Báo cáo chính trị, báo cáo tổng kết công tác xây dựng Đảng","Cương lĩnh xây dựng đất nước trong thời kỳ quá độ lên chủ nghĩa xã hội, Chiến lược ổn định và phát triển kinh tế - xã hội đến năm 2000","Báo cáo chính trị, nghị quyết về nhiệm vụ và đường lối của Đảng trong giai đoạn mới","Phương hướng, nhiệm vụ, kế hoạch phát triển kinh tế-xã hội 5 năm 1996-2000, Điều lệ Đảng (bổ sung, sửa đổi)"], ans: 1 },
    { type: 'mc', q: "Nội dung nào không có trong đại hội Đảng toàn quốc lần thứ VII?", options: ["Xác định 7 phương hướng lớn xây dựng chủ nghĩa xã hội","Chỉ ra những thành công, khuyết điểm, sai lầm trong hơn 60 năm lãnh đạo của Đảng","Nêu ra 6 bài học chủ yếu trong 10 năm đổi mới","Thông qua “chiến lược ổn định và phát triển kinh tế - xã hội đến năm 2000\""], ans: 2 },
    { type: 'mc', q: "Điền từ còn thiếu vào chỗ trống: “Nghị quyết Đại hội VII của Đảng đã đưa ra quan điểm coi ... là nhân tố quyết định, là động lực to lớn, là chủ thể sáng tạo mọi nguồn của cải, vật chất là tinh thần của xã hội, là mục tiêu phấn đấu cao nhất của Đảng”", options: ["Nhân dân","Con người","Khoa học, kỹ thuật","Kinh tế"], ans: 1 },
    { type: 'mc', q: "Điền từ còn thiếu vào chỗ trống: “Trong hệ thống chính trị, ...... là một bộ phận và là tổ chức lãnh đạo hệ thống đó, lấy Chủ nghĩa Mác - Lênin và Tư tưởng Hồ Chí Minh làm nền tảng tư tưởng, kim chỉ nam cho hành động, lấy ...... làm nguyên tắc tổ chức cơ bản.\"", options: ["Nhà nước - đa số thắng thiểu số","Chính phủ - phê bình và tự phê bình","Đảng Cộng sản - tập trung dân chủ","Nhân dân - tập trung dân chủ"], ans: 2 },
    { type: 'mc', q: "Chiến lược ổn định và phát triển kinh tế - xã hội đến năm 2000 do Đại hội VII thông qua nhằm mục tiêu gì?", options: ["Bình ổn xã hội, phát triển đất nước, đưa đất nước thoát ra khỏi khó khăn","Bình ổn xã hội, phát triển đất nước, đưa đất nước thoát ra khỏi nghèo nàn","Bình ổn xã hội, phát triển đất nước, đưa đất nước thoát ra khỏi cạnh tranh","Bình ổn xã hội, phát triển đất nước, đưa đất nước thoát ra khỏi kém phát triển"], ans: 0 },
    { type: 'mc', q: "Quan hệ đối ngoại và hội nhập quốc tế của Việt Nam sau Đại hội VII có những điểm gì?", options: ["Ngày càng sâu rộng và toàn diện; vị thế, uy tín của Việt Nam trên trường quốc tế được tăng cường.","Ngày càng toàn diện và sâu sắc; vị thế, uy tín của Việt Nam trên trường quốc tế được tăng cường.","Ngày càng sâu rộng và hiệu quả; vị thế, uy tín của Việt Nam trên trường quốc tế được nâng cao.","Ngày càng bền vững và phát triển; vị thế, uy tín của Việt Nam trên trường quốc tế được nâng cao."], ans: 2 },
    { type: 'mc', q: "Hội nghị Trung ương 5 khóa VII đã ban hành Nghị quyết nào về tiếp tục đổi mới và phát triển kinh tế - xã hội nông thôn?", options: ["Nghị quyết số 02-NQ/TW","Nghị quyết số 03-NQ/TW","Nghị quyết số 04-NQ/TW","Nghị quyết số 05-NQ/TW"], ans: 3 },
    { type: 'mc', q: "“Xây dựng xong về cơ bản những cơ sở kinh tế của chủ nghĩa xã hội, với kiến trúc thượng tầng về chính trị và tư tưởng, văn hóa phù hợp, làm cho nước ta trở thành một nước xã hội chủ nghĩa phồn vinh là:", options: ["Mục tiêu lâu dài của Cương lĩnh xây dựng đất nước trong thời kỳ quá độ lên chủ nghĩa xã hội","Mục tiêu tổng quát của Cương lĩnh năm 1991","Mục tiêu cấp thiết của Chiến lược ổn định và phát triển kinh tế- xã hội đến năm 2000","Mục tiêu quan trọng của Chiến lược ổn định và phát triển kinh tế xã hội đến năm 2000"], ans: 1 },
    { type: 'mc', q: "Khẳng định nào sau đây là của Đại hội VII về lĩnh vực kinh tế?", options: ["Nền kinh tế bước đầu chuyển biến tích cực","Thu nhập quốc dân tăng và giải quyết được nạn đói","Nhịp độ phát triển kinh tế cao","Cần phát triển kinh tế tập thể và chủ trương xác lập môi trường thể chế"], ans: 0 },
    { type: 'mc', q: "Điền tiếp vào chỗ trống: Đại hội đại biểu toàn quốc lần thứ VII đã khẳng định: \"Việt Nam muốn là bạn với tất cả các nước trong cộng đồng thế giới, phấn đấu vì ... và ...\"", options: ["Độc lập - tự do - hạnh phúc","Hòa bình - độc lập - phát triển","Hòa bình - hữu nghị - phát triển","Độc lập - hòa bình - tự do"], ans: 1 },
    { type: 'mc', q: "Kế hoạch 5 năm 1991-1995 không có nội dung nào sau đây:", options: ["Đẩy lùi và kiểm soát lạm phát","Ổn định phát triển và nâng cao hiệu quả nền sản xuất xã hội","Bước đầu tạo ra một cơ cấu kinh tế hợp lý","Bắt đầu có tích lũy từ nội bộ nền kinh tế."], ans: 2 },
    { type: 'mc', q: "Điền từ còn thiếu vào chỗ trống sau: “lấy liên minh giai cấp..., giai cấp ... và ... làm nền tảng do Đảng Công sản lãnh đạo. Thực hiên đủ quyền làm chủ của nhân dân”", options: ["công nhân, địa chủ, giai cấp tiểu tư sản","địa chủ, nông dân, giai cấp trí thức","công nhân, nông dân, giai cấp trí thức","công nhân, nông dân, tầng lớp trí thức"], ans: 3 },
    { type: 'mc', q: "Đại hội VII lần đầu tiên thông qua Chiến lược ổn định và phát triển KT-XH đến năm 2000, trong đó xác định mục tiêu tổng quát đến năm 2000 là:", options: ["Ra khỏi khủng hoảng, ổn định nền kinh tế xã hội, phấn đấu tình trạng nước nghèo và kém phát triển","Trở thành nước đang phát triển có thu nhập trung bình thấp, có nền công nghiệp hiện đại phát triển","Đổi mới cơ chế quản lý, xóa bỏ cơ chế tập trung quan liêu, hành chính, bao cấp, chuyển sang hạch toán, kinh doanh, kết hợp kế hoạch với thị trường","Đổi mới cơ chế quản lý kinh tế, giải quyết những vấn đề cấp bách về phân phối lưu thông"], ans: 0 },
    { type: 'mc', q: "Nhận định nào sau đây không đúng khi nói về Đại hội VII?", options: ["Coi nông nghiệp là mặt trận hàng đầu và có cách nhìn toàn diện","Tạo điều kiện cho mọi người có cuộc sống ấm no hạnh phúc","Cần thiết phát triển kinh tế tập thể.","Hình thành nền kinh tế hàng hóa thành phần, vận động theo cơ chế thị trường, có sự quản lý của Nhà nước, theo định hướng xã hội chủ nghĩa"], ans: 2 },
    { type: 'mc', q: "Đâu là quan điểm trong Đại hôi Đại biểu toàn quốc lần thứ VII của Đảng Công sản Việt Nam?", options: ["Đảng gắn liền với việc xây dựng và thực hiện thắng lợi Cương lĩnh, chiến lược và công cuộc đổi mới","Vân dụng quan điểm của Lenin coi nền kinh tế có cơ cấu nhiều thành phần và là một đặc trưng của thời kỳ quá độ","Theo quy luật về sự phù hợp giữa quan hệ sản xuất với tính chất và trình độ của lực lượng sản xuất","Công nghiệp hóa, hiện đại hóa là sự nghiệp của toàn dân, của mọi thành phần kinh tế, trong đó kinh tế nhà nước là chủ đạo"], ans: 0 },
    { type: 'mc', q: "Đại hôi Đại biểu toàn quốc lần thứ VII của Đảng Công sản Việt Nam đã đề ra bao nhiêu phương hướng trong Cương lĩnh?", options: ["4","5","6","7"], ans: 3 },
    { type: 'mc', q: "Đâu không phải là vấn đề quan trọng mà Hôi nghị lần thứ ba của Đại hội VII đã thảo luận?", options: ["Tình hình thế giới và chính sách đối ngoại","Củng cố quốc phòng, giữ vững an ninh quốc gia","Đổi mới và chỉnh đốn Đảng","Đa dạng hóa và bảo tồn văn hóa nước nhà"], ans: 3 },
    { type: 'mc', q: "Đâu là 3 nội dung tiến hành đổi mới được Đại hôi Đại biểu toàn quốc lần thứ VII của Đảng Công sản Việt Nam đề cập đến?", options: ["quốc phòng, an ninh, đối ngoại","văn hóa, kinh tế, chính trị","đối ngoại, xã hôi, văn hóa","văn hóa, quốc phòng, an ninh"], ans: 0 },
    { type: 'mc', q: "Đâu không phải là nôi dung văn hóa trong Đại hội Đại biểu toàn quốc lần thứ VII của Đảng Công sản Việt Nam?", options: ["Kế thừa và phát huy những truyền thống văn hoá tốt đẹp của tất cả các dân tộc trong nước, tiếp thu những tinh hoa văn hoá nhân loại","Sự nghiệp văn hóa, giáo dục phải được tiếp tục phát triển và nâng cao chất lượng","Xây dựng đất nước có nền văn hóa tiên tiến, đâm đà bản sắc dân tộc","Lấy chủ nghĩa Mác-Lênin, tư tưởng Hồ Chí Minh là nền tảng trong đời sống tỉnh thần xã hội."], ans: 1 },
    { type: 'mc', q: "Điền từ còn thiếu vào chỗ trống để tạo thành một mệnh đề đúng: “Văn hóa trong Đại hôi Đại biểu toàn quốc lần thứ VII của Đảng Công sản Việt Nam mặc dù được ... nhưng chưa được...\"", options: ["tập trung phát triển, như ý muốn","quan tâm phát triển, xem là vấn đề trọng tâm","quan tâm phát triển, xem là vấn đề đáng quan ngại","tập trung phát triển, xem là vấn đề trọng tâm"], ans: 1 },
    { type: 'fitb', q: "Đến cuối năm \_\_\_\_\_, Việt Nam có quan hệ ngoại giao với 160 nước.", correctAnswer: "1995" },
    { type: 'mc', q: "Đại hội VII họp trong bối cảnh nào của hệ thống XHCN thế giới?", options: ["CNXH thế giới sụp đổ.","CNXH thế giới phát triển nhanh chóng.","CNXH thế giới mới hình thành.","CNXH thế giới chưa hình thành"], ans: 0 },
    { type: 'mc', q: "Đại hội VII đã thông qua Cương lĩnh chính trị lần thứ mấy của Đảng, và đó là cương lĩnh nào?", options: ["Lần thứ 4, Cương lĩnh 1991.","Lần thứ 5, Cương lĩnh 1991.","Lần thứ 6, Cương lĩnh 1991.","Lần thứ 7, Cương lĩnh 1991."], ans: 0 },
    { type: 'mc', q: "Đặc trưng về chính trị của CNXH trong Cương lĩnh 1991 là gì?", options: ["Giai cấp công nhân làm chủ.","Giai cấp nông dân làm chủ.","Giai cấp tư sản làm chủ.","Nhân dân lao động làm chủ."], ans: 3 },
    { type: 'mc', q: "Đặc trưng về kinh tế của CNXH trong Cương lĩnh 1991 là gì?", options: ["Kinh tế phát triển toàn diện.","Kinh tế thị trường.","Kinh tế phát triển cao.","Kinh tế phát triển ổn định"], ans: 2 },
    { type: 'fitb', q: "Mục tiêu phấn đấu cao nhất của Đảng được Hội nghị giữa nhiệm kỳ (1/1994) khóa VII xác định là \_\_\_\_\_ của con người.", correctAnswer: "hạnh phúc" },
];

const supplementaryQuestions = [
    { type: 'mc', q: "Đơn vị tiền tệ của Việt Nam là gì?", options: ["Đồng","VND","VNĐ","Tất cả đều đúng"], ans: 3 },
    { type: 'fitb', q: "Sông dài nhất thế giới là \_\_\_\_\_.", correctAnswer: "sông Nile" },
    { type: 'mc', q: "Núi cao nhất Việt Nam?", options: ["Fansipan","Phú Sĩ","Everest"], ans: 0 },
    { type: 'fitb', q: "Thủ đô của Việt Nam là \_\_\_\_\_.", correctAnswer: "Hà Nội" },
    { type: 'mc', q: "Hành tinh nào gần Mặt trời nhất?", options: ["Trái Đất","Sao Thủy","Sao Hỏa"], ans: 1 },
    { type: 'mc', q: "Châu lục nào lớn nhất?", options: ["Châu Á","Châu Âu","Châu Phi"], ans: 0 },
    { type: 'fitb', q: "Số π xấp xỉ \_\_\_\_\_.", correctAnswer: "3.14" },
    { type: 'mc', q: "Mặt trời là gì?", options: ["Hành tinh","Sao","Nguyệt"], ans: 1 },
    { type: 'mc', q: "2*3 = ?", options: ["5","6","7"], ans: 1 },
    { type: 'mc', q: "Màu của bầu trời?", options: ["Xanh","Đỏ","Vàng"], ans: 0 },
    { type: 'mc', q: "Văn Miếu - Quốc Tử Giám được xây dựng vào triều đại nào?", options: ["Lý","Trần","Hồ","Lê"], ans: 0 },
    { type: 'mc', q: "Đại dương lớn nhất trên thế giới?", options: ["Thái Bình Dương","Đại Tây Dương","Ấn Độ Dương"], ans: 0 },
    { type: 'fitb', q: "Tổng thống đầu tiên của Hoa Kỳ là \_\_\_\_\_.", correctAnswer: "George Washington" },
];

let masterQuestions = [...officialQuestions];
if (masterQuestions.length < 50) {
    masterQuestions = masterQuestions.concat(supplementaryQuestions);
}
while (masterQuestions.length < 50) {
    masterQuestions = masterQuestions.concat(officialQuestions.slice(0, 50 - masterQuestions.length));
}

const BOARD_SIZE = 5;

function createBoard(boardId) {
    const board = document.getElementById(boardId);
    const labels = ['A','B','C','D','E'];

    board.appendChild(document.createElement('div')); // góc
    for (let j = 1; j <= BOARD_SIZE; j++) {
        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = j;
        board.appendChild(label);
    }

    for (let i = 0; i < BOARD_SIZE; i++) {
        const rowLabel = document.createElement('div');
        rowLabel.className = 'label';
        rowLabel.textContent = labels[i];
        board.appendChild(rowLabel);

        for (let j = 0; j < BOARD_SIZE; j++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            const index = `${labels[i]}${j+1}`;
            cell.dataset.index = index;
            cell.dataset.boardId = boardId;
            cell.dataset.hasQuestion = 'false';
            cell.dataset.answered = 'false';
            
            const cellIndex = (i * BOARD_SIZE) + j;
            let questionIndex;

            if (boardId === 'board1') {
                questionIndex = cellIndex;
            } else {
                questionIndex = cellIndex + (BOARD_SIZE * BOARD_SIZE);
            }

            if (masterQuestions[questionIndex]) {
                cell.questionData = masterQuestions[questionIndex];
                cell.dataset.hasQuestion = 'true';
            }

            board.appendChild(cell);
        }
    }
}
createBoard('board1');
createBoard('board2');

const popup = document.getElementById('popup');
const redBtn = document.querySelector('.color-btn.red');
const blueBtn = document.querySelector('.color-btn.blue');
let currentCell = null;

const quizPopup = document.getElementById('quizPopup');
const quizBox = document.getElementById('quizBox');
const quizQuestion = document.getElementById('quizQuestion');
const quizContent = document.getElementById('quizContent');
const backBtn = document.getElementById('backBtn');

const rulePopup = document.getElementById('rulePopup');
const ruleBtn = document.getElementById('ruleBtn');
const closeRuleBtn = document.getElementById('closeRuleBtn');

ruleBtn.addEventListener('click', () => {
    rulePopup.style.display = 'flex';
});

closeRuleBtn.addEventListener('click', () => {
    rulePopup.style.display = 'none';
});

rulePopup.addEventListener('click', (e) => {
    if (e.target === rulePopup) {
        rulePopup.style.display = 'none';
    }
});

document.querySelectorAll('.cell').forEach(cell => {
    cell.addEventListener('click', (e) => {
        currentCell = e.currentTarget;
        const rect = currentCell.getBoundingClientRect();
        const left = rect.right + 8;
        let top = rect.top;
        if (left + 150 > window.innerWidth) {
            popup.style.left = (rect.left - 8 - 60) + 'px';
        } else {
            popup.style.left = left + 'px';
        }
        if (top + 50 > window.innerHeight) top = window.innerHeight - 60;
        popup.style.top = top + 'px';
        popup.style.display = 'flex';
    });

    cell.addEventListener('dblclick', (e) => {
        currentCell = e.currentTarget;
        popup.style.display = 'none';
        quizBox.classList.remove('celebrate');
        
        if (currentCell.dataset.answered === 'true') {
            return;
        }
        
        currentCell.classList.remove('hit', 'miss');
        currentCell.textContent = '';
        openQuizForCell(currentCell);
    });
});

redBtn.addEventListener('click', () => {
    if (currentCell) {
        currentCell.textContent = '';
        currentCell.classList.remove('miss');
        currentCell.classList.add('hit');
        currentCell.dataset.answered = 'false';
    }
    popup.style.display = 'none';
});

blueBtn.addEventListener('click', () => {
    if (currentCell) {
        currentCell.textContent = '';
        currentCell.classList.remove('hit');
        currentCell.classList.add('miss');
        currentCell.dataset.answered = 'false';
    }
    popup.style.display = 'none';
});

window.addEventListener('click', (e) => {
    if (!popup.contains(e.target) && !e.target.classList.contains('cell') && !e.target.closest('.color-btn')) {
        popup.style.display = 'none';
    }
});

function openQuizForCell(cell) {
    let data;

    if (cell.dataset.hasQuestion === 'true' && cell.questionData) {
        data = cell.questionData;
    } else {
        alert(`Ô ${cell.dataset.index} chưa được gán câu hỏi cố định.`);
        return;
    }

    quizQuestion.textContent = data.q;
    quizContent.innerHTML = '';
    
    if (data.type === 'mc') {
        renderMultipleChoice(data);
    } else if (data.type === 'fitb') {
        renderFillInTheBlank(data);
    }

    quizPopup.style.display = 'flex';
}

function celebrate() {
    quizBox.classList.add('celebrate');
    setTimeout(() => quizBox.classList.remove('celebrate'), 500);
}

function updateCellOnAnswer(isCorrect) {
    if (currentCell) {
        currentCell.dataset.answered = 'true';
        currentCell.classList.remove('hit', 'miss');
        currentCell.textContent = '';
    }
}

function renderMultipleChoice(data) {
    data.options.forEach((opt, idx) => {
        const o = document.createElement('div');
        o.className = 'option';
        o.textContent = opt;
        o.dataset.idx = idx;
        
        o.addEventListener('click', (e) => {
            const allOptions = Array.from(quizContent.children);
            allOptions.forEach(ch => ch.style.pointerEvents = 'none');
            
            const selectedIndex = Number(e.currentTarget.dataset.idx);
            let isCorrect = selectedIndex === data.ans;
            
            allOptions.forEach(ch => {
                if (Number(ch.dataset.idx) === data.ans) {
                    ch.classList.add('correct');
                }
            });
            
            if (!isCorrect) {
                e.currentTarget.classList.add('wrong');
            } else {
                celebrate();
            }

            updateCellOnAnswer(isCorrect);
        });
        quizContent.appendChild(o);
    });
}

function renderFillInTheBlank(data) {
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'fitb-input';
    input.placeholder = 'Nhập câu trả lời của bạn...';
    
    const button = document.createElement('button');
    button.className = 'fitb-btn';
    button.textContent = 'Kiểm tra';

    const feedback = document.createElement('div');
    feedback.className = 'fitb-feedback';
    
    quizContent.appendChild(input);
    quizContent.appendChild(button);
    quizContent.appendChild(feedback);

    let answered = false;
    
    button.addEventListener('click', () => {
        if (answered) return;

        const normalize = (text) => text.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/\s{2,}/g," ").trim();

        const userAnswer = normalize(input.value);
        const correctAnswer = normalize(data.correctAnswer);
        
        let isCorrect = (userAnswer === correctAnswer);

        input.disabled = true;
        button.style.pointerEvents = 'none';
        answered = true;

        if (isCorrect) {
            feedback.innerHTML = 'CHÍNH XÁC! 🎉✨';
            feedback.style.color = '#8cd179';
            celebrate();
            updateCellOnAnswer(true);
        } else {
            feedback.innerHTML = `SAI. Đáp án đúng là: <strong>${data.correctAnswer}</strong>`;
            feedback.style.color = '#ff7b7b';
            updateCellOnAnswer(false);
        }
    });

    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !answered) {
            button.click();
        }
    });
}

backBtn.addEventListener('click', () => {
    quizPopup.style.display = 'none';
});

/* --- New Ship Placement Logic --- */
let currentTeam = 1; // 1 for Team 1, 2 for Team 2
let shipOrientation = 'horizontal'; // default
let team1Ships = []; // store ship positions for Team 1
let team2Ships = []; // store ship positions for Team 2
let placingShips = false;

const placeShipsBtn = document.getElementById('placeShipsBtn');
const showShipsBtn = document.getElementById('showShipsBtn');
const showShipsPopup = document.getElementById('show-ships-popup');
const showTeam1Btn = document.getElementById('show-team1');
const showTeam2Btn = document.getElementById('show-team2');
const showBothBtn = document.getElementById('show-both');
const hideAllBtn = document.getElementById('hide-all-ships');

// Toggle orientation on 'R' key
document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'r' && placingShips) {
        shipOrientation = shipOrientation === 'horizontal' ? 'vertical' : 'horizontal';
        document.querySelectorAll('.ship').forEach(ship => {
            ship.classList.remove('horizontal', 'vertical');
            ship.classList.add(shipOrientation);
            if (shipOrientation === 'vertical') {
                ship.style.width = '70px';
                ship.style.height = (parseInt(ship.dataset.length) * 70) + 'px';
            } else {
                ship.style.width = (parseInt(ship.dataset.length) * 70) + 'px';
                ship.style.height = '70px';
            }
        });
    }
});

// Start placing ships
placeShipsBtn.addEventListener('click', () => {
    if (placingShips) return;
    placingShips = true;
    currentTeam = 1;
    alert('Team 1: Đặt thuyền của bạn. Nhấn R để xoay thuyền.');
    createShipContainer('board1');
});

// Create ship container for dragging
function createShipContainer(boardId) {
    let shipContainer = document.querySelector('.ship-container');
    if (shipContainer) shipContainer.remove();

    shipContainer = document.createElement('div');
    shipContainer.className = 'ship-container';
    document.body.appendChild(shipContainer);

    const lengths = [3, 2, 1];
    lengths.forEach(length => {
        const ship = document.createElement('div');
        ship.className = `ship ${shipOrientation}`;
        ship.draggable = true;
        ship.dataset.length = length;
        ship.style.display = 'flex';
        for (let i = 0; i < length; i++) {
            const unit = document.createElement('div');
            unit.className = 'ship-unit';
            ship.appendChild(unit);
        }
        if (shipOrientation === 'horizontal') {
            ship.style.flexDirection = 'row';
            ship.style.width = (length * 70) + 'px';
            ship.style.height = '70px';
        } else {
            ship.style.flexDirection = 'column';
            ship.style.width = '70px';
            ship.style.height = (length * 70) + 'px';
        }
        shipContainer.appendChild(ship);

        ship.addEventListener('dragstart', dragStart);
    });

    // Add save button
    const saveBtn = document.createElement('button');
    saveBtn.textContent = 'Lưu';
    saveBtn.className = 'action-btn';
    saveBtn.style.position = 'static';
    saveBtn.addEventListener('click', saveShips);
    shipContainer.appendChild(saveBtn);

    // Make board droppable
    const board = document.getElementById(boardId);
    board.addEventListener('dragover', dragOver);
    board.addEventListener('drop', dropShip);
}

function dragStart(e) {
    e.dataTransfer.setData('text/plain', e.target.dataset.length);
    e.dataTransfer.setData('orientation', shipOrientation);
}

function dragOver(e) {
    e.preventDefault();
}

function dropShip(e) {
    e.preventDefault();
    const length = parseInt(e.dataTransfer.getData('text/plain'));
    const orientation = e.dataTransfer.getData('orientation');
    const targetCell = e.target.closest('.cell');
    if (!targetCell || targetCell.classList.contains('ship')) return;

    const board = targetCell.closest('.board');
    const cells = Array.from(board.querySelectorAll('.cell'));
    const targetIndex = cells.indexOf(targetCell);

    const row = Math.floor(targetIndex / BOARD_SIZE);
    const col = targetIndex % BOARD_SIZE;

    let positions = [];
    for (let i = 0; i < length; i++) {
        let cellIndex;
        if (orientation === 'horizontal') {
            if (col + i >= BOARD_SIZE) return; // Out of bounds
            cellIndex = row * BOARD_SIZE + (col + i);
        } else {
            if (row + i >= BOARD_SIZE) return; // Out of bounds
            cellIndex = (row + i) * BOARD_SIZE + col;
        }
        if (cells[cellIndex].classList.contains('ship')) return; // Overlap
        positions.push(cells[cellIndex].dataset.index);
        cells[cellIndex].classList.add('ship');
    }

    // Remove the dragged ship from container
    const draggedShip = document.querySelector(`.ship[data-length="${length}"]`);
    if (draggedShip) draggedShip.remove();
}

function saveShips() {
    const boardId = currentTeam === 1 ? 'board1' : 'board2';
    const board = document.getElementById(boardId);
    const cells = Array.from(board.querySelectorAll('.cell'));
    const shipPositions = cells.reduce((acc, cell, idx) => {
        if (cell.classList.contains('ship')) {
            acc.push(cell.dataset.index);
            cell.classList.remove('ship'); // Hide ships
        }
        return acc;
    }, []);

    if (currentTeam === 1) {
        team1Ships = shipPositions;
        alert('Team 1 đã lưu thuyền. Bây giờ đến Team 2.');
        currentTeam = 2;
        createShipContainer('board2');
    } else {
        team2Ships = shipPositions;
        alert('Team 2 đã lưu thuyền. Đặt thuyền hoàn tất.');
        placingShips = false;
        const shipContainer = document.querySelector('.ship-container');
        if (shipContainer) shipContainer.remove();
    }
}

// Show ships button
showShipsBtn.addEventListener('click', () => {
    showShipsPopup.style.display = 'flex';
});

showTeam1Btn.addEventListener('click', () => showShips('team1'));
showTeam2Btn.addEventListener('click', () => showShips('team2'));
showBothBtn.addEventListener('click', () => showShips('both'));
hideAllBtn.addEventListener('click', () => showShips('none'));

showShipsPopup.addEventListener('click', (e) => {
    if (e.target === showShipsPopup) {
        showShipsPopup.style.display = 'none';
    }
});

function showShips(mode) {
    const board1Cells = Array.from(document.getElementById('board1').querySelectorAll('.cell'));
    const board2Cells = Array.from(document.getElementById('board2').querySelectorAll('.cell'));

    // Hide all first
    board1Cells.forEach(cell => cell.classList.remove('ship'));
    board2Cells.forEach(cell => cell.classList.remove('ship'));

    if (mode === 'team1' || mode === 'both') {
        team1Ships.forEach(index => {
            const cell = board1Cells.find(c => c.dataset.index === index);
            if (cell) cell.classList.add('ship');
        });
    }

    if (mode === 'team2' || mode === 'both') {
        team2Ships.forEach(index => {
            const cell = board2Cells.find(c => c.dataset.index === index);
            if (cell) cell.classList.add('ship');
        });
    }

    showShipsPopup.style.display = 'none';
}

</script>
</body>
</html>